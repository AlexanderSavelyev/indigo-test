#include <dlfcn.h>
#include <stdio.h>
typedef const char* (*VOID_RET_STR)();

#ifndef _WIN32

int main(int argc, char **argv)
{
	void *indigoHandle;
	void *indigoInChIHandle;
	void *indigoRendererHandle;
	VOID_RET_STR indigoVersion;
	indigoHandle = dlopen("lib/libindigo.so", RTLD_GLOBAL | RTLD_NOW);
	if (!indigoHandle)
	{
               fputs(dlerror(), stderr);
               return 1;
	}
	printf("Indigo instance: %d\n", (int)indigoHandle);
	indigoInChIHandle = dlopen("lib/libindigo-inchi.so", RTLD_GLOBAL | RTLD_NOW);
        if (!indigoInChIHandle)
        {
               fputs(dlerror(), stderr);
               return 1;
        }
	printf("IndigoInchi instance: %d\n", (int)indigoInChIHandle);
	indigoRendererHandle = dlopen("lib/libindigo-renderer.so", RTLD_GLOBAL | RTLD_NOW);
        if (!indigoRendererHandle)
	{
		fputs(dlerror(), stderr);
		return 1;
	}
	printf("IndigoRenderer instance: %d\n", (int)indigoRendererHandle);
	indigoVersion = (VOID_RET_STR)dlsym(indigoHandle, "indigoVersion");
        printf("Indigo version: %s\n", indigoVersion());
	dlclose(indigoRendererHandle);
	dlclose(indigoInChIHandle);
	dlclose(indigoHandle);
	return 0;
}

#else

#endif
