cmake_minimum_required(VERSION 2.6)
project(Pixman C)

set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/../../common/cmake/)
if(USE_LOCAL_PIXMAN)
    set(PIXMAN_FOUND "NO")
    message(STATUS "Using local Pixman")
else()
    find_package(PIXMAN)
endif()
if (NOT PIXMAN_FOUND)
    set(Pixman_headers_dir ${CMAKE_CURRENT_SOURCE_DIR}/pixman)
    include_directories(${Pixman_headers_dir})

    add_definitions(-DPACKAGE -DHAVE_PTHREAD_SETSPECIFIC)
    file (GLOB Pixman_src "pixman/*.c")
    file (GLOB Pixman_headers "pixman/*.h")
    list(REMOVE_ITEM Pixman_src ${CMAKE_CURRENT_SOURCE_DIR}/pixman/pixman-vmx.c)
    list(REMOVE_ITEM Pixman_src ${CMAKE_CURRENT_SOURCE_DIR}/pixman/pixman-mmx.c)
    list(REMOVE_ITEM Pixman_src ${CMAKE_CURRENT_SOURCE_DIR}/pixman/pixman-sse2.c)
    list(REMOVE_ITEM Pixman_src ${CMAKE_CURRENT_SOURCE_DIR}/pixman/pixman-region.c)
    find_package(PNG)
    if (NOT PNG_FOUND)
        include_directories(${PNG_SOURCE_DIR}/include)
    endif()
    if(APPLE)
        set(CMAKE_OSX_ARCHITECTURES "i386;x86_64")
    endif()
    add_library(pixman STATIC ${Pixman_src} ${Pixman_headers})
    if (NOT PNG_FOUND)
        target_link_libraries(pixman png)
    endif()
else()
    set(Pixman_headers_dir ${PIXMAN_INCLUDE_DIRS})
endif()
